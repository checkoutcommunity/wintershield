$(document).ready(function(){$("body").removeClass("preload"),$(".mob-nav").slideAndSwipe(),$(".mob-menu select, .mob-doc-menu select").on("change",function(){window.location.replace($(this).val())}),$(".float input, .float textarea").each(function(t){$(this).wrap("<fieldset></fieldset>");var e=$(this).attr("placeholder");$(this).attr("placeholder",""),""==!$(this).val()?$(this).after("<label for='name' class='stay'>"+e+"</label>"):$(this).after("<label for='name'>"+e+"</label>")}),$(".float input, .float textarea").on("blur",function(){""==!$(this).val()?$(this).next().addClass("stay"):$(this).next().removeClass("stay")}),$(".form-control").live("focus",function(){$(this).removeClass("error")}),$(".payment-methods ul").carouFredSel({auto:!1,responsive:!0,width:"100%",scroll:{items:1,fx:"scroll",duration:500},prev:".prev",next:".next",items:{height:"auto",visible:{min:1,max:6}},mousewheel:!0,swipe:{onMouse:!0,onTouch:!0}}),$(".help-box .question").live("click",function(){"none"==$(this).next(".answer").css("display")?($(".question").removeClass("active"),$(this).addClass("active"),$(".answer").hide("normal"),$(this).next(".answer").toggle("normal")):($(".question").removeClass("active"),$(".answer").hide("normal"))}),$(".support input, .support textarea").on("blur",function(){var t=new RegExp(/^[a-z0-9._-]+@[a-z0-9-]+\.[a-z]{2,6}$/i);("email"==$(this).attr("name")&&!t.test($(this).val())||"title"==$(this).attr("name")&&$(this).val().trim().length<1||"message"==$(this).attr("name")&&$(this).val().trim().length<10)&&$(this).addClass("error")}),$(".support").on("submit",function(){return $($(this).serializeArray()).each(function(){this.value.trim().length<1&&$(".support [name="+this.name+"]").addClass("error")}),$(this).find("input, textarea[name='message']").hasClass("error")||($(".support button").addClass("disabled").prop("disabled",!0).html("<div class='preloader-wrapper active'><div class='spinner-layer'><div class='circle-clipper left'><div class='circle'></div></div><div class='gap-patch'><div class='circle'></div></div><div class='circle-clipper right'><div class='circle'></div></div></div></div>"),setTimeout(function(){$.ajax({url:"/support",type:"POST",data:$(".support").serialize()+"&action=send",cache:!1,dataType:"json",success:function(t){t.error?(note({content:t.error,type:"error",time:5}),t.highlight&&$(t.highlight.split(", ")).each(function(t,e){$(".support input[name="+e+"]").addClass("error")}),"1"==t.code&&grecaptcha.reset(),$(".support button").removeClass("disabled").prop("disabled",!1).html("Отправить")):t.success&&(note({content:t.success,type:"success",time:10}),$(".support label").removeClass("stay"),$(".support input, .support textarea").val(""),grecaptcha.reset(),$(".support button").removeClass("disabled").prop("disabled",!1).html("Отправить"))},error:function(){note({content:"Ошибка соединения с сервером",type:"error",time:5}),grecaptcha.reset(),$(".support button").removeClass("disabled").prop("disabled",!1).html("Отправить")}})},500)),!1}),$(".ticket").on("submit",function(){return $(".ticket textarea").val().trim().length<1&&$(".ticket textarea").addClass("error"),$(".ticket textarea").hasClass("error")||($(".ticket button").addClass("disabled").prop("disabled",!0).html("<div class='preloader-wrapper active'><div class='spinner-layer'><div class='circle-clipper left'><div class='circle'></div></div><div class='gap-patch'><div class='circle'></div></div><div class='circle-clipper right'><div class='circle'></div></div></div></div>"),setTimeout(function(){$.ajax({url:"/support/ticket",type:"POST",data:$(".ticket").serialize()+"&action=send",cache:!1,dataType:"json",success:function(t){t.error?(note({content:t.error,type:"error",time:5}),$(".ticket button").removeClass("disabled").prop("disabled",!1).html("Отправить")):t.success&&($(".ticket-messages").html(t.success),$(".ticket-form span p").removeClass().addClass("waiting").text("На рассмотрении"),$(".ticket textarea").val(""),$(".ticket .image, .ticket .input").html(""),$(".ticket .close").removeClass("hide"),$(".ticket button").removeClass("disabled").prop("disabled",!1).html("Отправить"))},error:function(){note({content:"Ошибка соединения с сервером",type:"error",time:5}),$(".ticket button").removeClass("disabled").prop("disabled",!1).html("Отправить")}})},500)),!1}),$(".ticket-form input[type=file]").on("change",function(){var t=$(".ticket-form input[name=id]").val(),e=$(".ticket-form input[name=email]").val(),i=$(".ticket-form input[name=hash]").val(),s=$(".ticket-form input[name=token]").val(),a=!1;5<=count&&(note({content:"Можно прикрепить не более 5 изображений",type:"error",time:5}),$(this).val(""),a=!0),a||((a=new FormData).append("image",$(this)[0].files[0]),$.ajax({url:"/support/ticket?id="+t+"&email="+e+"&hash="+i+"&token="+s+"&action=upload",type:"POST",data:a,cache:!1,dataType:"json",processData:!1,contentType:!1,success:function(t){var e;t.error?(note({content:t.error,type:"error",time:5}),$(".ticket-form input[type=file]").val("")):t.success&&(e=Math.floor(100*Math.random())+1,$(".ticket-form .input").append("<input type='hidden' name='image[]' id='"+e+"' value='"+t.success+"' />"),$(".ticket-form .image").append("<div class='block' id='"+e+"'><i></i><a href='"+t.success+"' target='_blank'><div style='background: url("+t.success+") no-repeat 50% 0;'></div></a></div>"),$(".ticket-form input[type=file]").val(""),count=+count+1)},error:function(){note({content:"Не удалось загрузить изображение",type:"error",time:5}),$(".ticket-form input[type=file]").val("")}}))}),$(".ticket .upload").on("click",function(){$(".ticket-form input[type=file]").click()}),$(".ticket .image i").live("click",function(){$(".ticket-form .input #"+$(this).parent().attr("id")).remove(),$(this).parent().remove(),count=+count-1}),$(".ticket .close").on("click",function(){$.ajax({url:"/support/ticket",type:"POST",data:$(".ticket").serialize()+"&action=close",cache:!1,dataType:"json",success:function(t){t.success&&($(".ticket-form span p").removeClass().addClass("closed").text("Закрыт"),$(".ticket .close").addClass("hide"))}})}),$(".doc-list-cat").live("click",function(){return $(".sticky-wrapper").css("height","unset"),"none"==$(this).next(".doc-list-box").css("display")?($(".doc-list-box").hide("normal"),$(this).next(".doc-list-box").toggle("normal")):$(".doc-list-box").hide("normal"),!1}),$(".news-item-load").on("click",function(){news=$(".news-item-load").data("total"),$(".news-item-load").html("Загрузка...").attr("disabled",!0),setTimeout(function(){$.ajax({url:"/news",type:"POST",data:{loading:!0,list:list,category:$(".news-item-load").data("cat")},cache:!1,success:function(t){t&&($(".news-list .container").append(t),list+=6,news<=list&&$(".news-item-load").hide(),$(".news-item-load").html("Загрузить еще").attr("disabled",!1))},error:function(){note({content:"Ошибка соединения с сервером",type:"error",time:5}),$(".news-item-load").html("Загрузить еще").attr("disabled",!1)}})},300)}),$(window).on("load resize",function(){$(".doc-list-block").removeAttr("style").attr("style","width: "+$(".doc-list-block").width()+"px;"),$(".doc-list-block").unstick(),500<$(window).width()&&$(".doc-list-block").sticky({topSpacing:15})})});